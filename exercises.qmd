---
title: "exercises.qmd"
format: html
editor: visual
---

```{r}
library(dplyr)
glimpse(tree_dat)
```

```{r}
#1
head(tree_dat)
library(dplyr)
tree_dat%>% summarize(n = n())

# This code uses glimpse() to provide a summary of the dataset.
# It allows us to see the column names, data types, and a preview of the data.
# From this, we observe that the dataset contains 8 columns: treeID, standID, stand, 
# year, species, age, inc_mm (growth increment in mm), and rad_ib_mm (radius in mm).

```


```{r}
#2
tree_dat %>%
  filter(standID == 1)%>%
  tally()

# This code filters the dataset to only include rows where standID is 1.
# The tally() function counts the number of rows that fufill this requirement.
# The result represents the number of records collected for stand 1. (979)

```


```{r}
#3
tree_dat %>%
  filter(species %in% c("ABBA", "PIST")) %>%
  count(species)

# We use filter() to select only the rows where species is either "ABBA" 
# or "PIST". The %in% operator makes it easy to filter multiple values.
# The count() function then tallies the numbers for each species.

```


```{r}
#3
tree_dat %>%
  filter(species %in% c("ABBA", "PIST")) %>%
  count(species)
```


```{r}
#4
last_year <- max(tree_dat$year, na.rm = TRUE)

tree_dat %>%
  filter(year == last_year, age > 200) %>%
  tally()

# Determine the most recent year in the dataset using max().
# Then, we filter the data to include only records from that year where age > 200.
# Finally, tally() counts how many exist.
```


```{r}
#5
tree_dat %>%
  slice_max(order_by = age, n = 1)

oldest_tree <- tree_dat %>%
  slice_max(order_by = age, n= 1)

print(oldest_tree)

# The slice_max() selects the row with the highest age value.
# This allows us to identify the oldest tree in the dataset.

```


```{r}
#6
tree_dat %>%
  filter(year == 2001) %>%
  slice_max(order_by = age, n = 5)

# Filter for records from the year 2001.
# Slice_max() selects the 5 rows with the highest age values.
# This provides the 5 oldest trees recorded in 2001.
```

```{r}
#7
tree_dat %>%
  filter(year == 2002) %>%
  slice_sample(prop = 0.3)%>%
  tally()

# Code filters for trees recorded in 2002.
# Then, slice_sample() randomly selects 30% of these records.
# The tally() function counts the number of selected rows.
```


```{r}
#8
tree_dat %>%
  filter(year == 2007) %>%
  arrange(desc(rad_ib_mm))%>%
  slice_head(n=3)

# Filter for trees in stand 5 recorded in 2007.
# The arrange() function sorts the data in descending order by tree radius.
# Then, slice_head() selects the top 3 records, which correspond to the largest trees.

```
Answer:

```{r}
#9
tree_dat %>%
  select(treeID, stand, year, rad_ib_mm) %>%
  filter(stand == 3, year == 2007) %>%
  slice_min(rad_ib_mm, n = 3)

# Select only the columns treeID, stand, year, and rad_ib_mm.
# The filter() function limits the data to stand 3 in 2007.
# slice_min() picks the 3 trees with the smallest radius.

```
Answer:

```{r}
#10
tree_dat %>%
  select(!stand) %>%
  glimpse()

# The select(!stand) function removes the "stand" column from the dataset.
# glimpse() then provides an updated summary of the dataset structure.
```

```{r}
#10 and 11
tree_dat %>%
  select(contains(c("ID", "stand"))) %>%
  glimpse()
```


```{r}
#13
tree_dat <- tree_dat %>%
  rename(rad_ib = rad_ib_mm, inc = inc_mm) 

glimpse(tree_dat)
```


```{r}
#14
tree_dat %>%
  mutate(
    DBH_cm = (rad_ib_mm / 10) * 2,
    BA_m2 = 0.00007854 * DBH_cm^2
  ) %>%
  filter(species == "POTR", year == 2007) %>%
  summarize(mean_BA = mean(BA_m2, na.rm = TRUE))

# Mutate() to convert rad_ib_mm to cm and compute DBH_cm.
# Calculate basal area (BA_m2) using the given formula.
# The filter() function selects only trees of species "POTR" in 2007.
# summarize() computes the mean basal area.

```


```{r}
#15
tree_dat %>%
  mutate(established = if_else(age > 5, TRUE, FALSE)) %>%
  count(established)
```

Answer:

```{r}
#16
tree_dat %>%
  mutate(
    rad_ib_cm = rad_ib_mm / 10,  
    DBH_cm = rad_ib_cm * 2
  ) %>%
  mutate(DBH_class = case_when(
    DBH_cm < 2.5 ~ "seedling",
    DBH_cm < 10 ~ "sapling",
    DBH_cm < 30 ~ "pole",
    TRUE ~ "sawlog"
  )) %>%
  filter(year == 2007) %>%
  count(DBH_class)

# Compute DBH_cm.
# case_when() assigns each tree to a DBH class based on its DBH.
# filter() function selects records from 2007.
# count() tallies the number of trees in each class.
```

```{r}
#17
tree_dat %>%
  filter(year == 2007) %>%
  mutate(
    rad_ib_cm = rad_ib_mm / 10,
    DBH_cm = rad_ib_cm * 2
  ) %>%
  summarise(
    mean_DBH = mean(DBH_cm, na.rm = TRUE),
    sd_DBH = sd(DBH_cm, na.rm = TRUE)
  )
```
Answer:

```{r}
#18
tree_dat %>%
  filter(year == 2003) %>%
  group_by(species) %>%
  summarise(mean_age = mean(age, na.rm = TRUE)) %>%
  arrange(desc(mean_age)) %>%
  slice_head(n = 3)
```

```{r}
#19
tree_dat %>%
  summarise(
    unique_years = n_distinct(year),
    first_year = min(year),
    last_year = max(year)
  )
```


```{r}
#Final Question
tree_dat %>%
  # Step 1: Convert radius to diameter first
  mutate(
    rad_ib_cm = rad_ib_mm / 10,  # Convert mm to cm
    DBH_cm = rad_ib_cm * 2        # Compute diameter at breast height (DBH)
  ) %>%
  # Step 2: Now that DBH_cm exists, compute growth rate
  group_by(species, treeID) %>%
  arrange(year) %>%  # Ensure correct chronological order
  mutate(growth_rate = DBH_cm - lag(DBH_cm)) %>%
  summarise(avg_growth = mean(growth_rate, na.rm = TRUE)) %>%
  arrange(desc(avg_growth))


# Group the data by species and treeID to track individual tree growth.
# The mutate() function calculates the annual DBH growth using lag().
# summarize() then computes the mean growth rate for each species.
# Arrange the results in descending order to find the fastest-growing species.

```

